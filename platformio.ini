; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[platformio]
src_dir = .

[base1549]
platform = nxplpc
platform_packages = 
	tool-openocd
board = lpc1549
framework = mbed
board_build.ldscript = target/LPC1549.ld
board_debug.openocd_target = "lpc1549_openocd"
board_upload.protocols = ["cmsis-dap"]
upload_protocol = cmsis-dap
upload_speed = 4000
monitor_speed = 115200
debug_tool = custom
debug_server = 
	$PLATFORMIO_CORE_DIR/packages/tool-openocd/bin/openocd
	-f $PLATFORMIO_CORE_DIR/packages/tool-openocd/scripts/interface/cmsis-dap.cfg
	-f target/lpc1549_openocd.cfg
	-c "adapter speed 4000"
lib_deps = 
	nanopb/NanoPb
	common-proto
	fw-libs
	graphics-api
build_flags = 
	-D DEVICE_USTICKER
src_build_flags = 
	-Wall

[basenrf52]
platform = nordicnrf52
platform_packages = 
	tool-openocd
board = nrf52840_dk
framework = mbed
board_upload.protocols = ["cmsis-dap"]
upload_protocol = cmsis-dap
upload_speed = 4000
monitor_speed = 115200
lib_deps = 
	nanopb/NanoPb
	common-proto
	graphics-api
	
src_build_flags = 
	-Wall

[sd_1549]
extends = base1549
lib_deps = ${base1549.lib_deps}
	MbedSdFat
build_flags = ${base1549.build_flags}
	-D MBED_CONF_FAT_CHAN_FFS_DBG=0
	-D MBED_CONF_FAT_CHAN_FF_CODE_PAGE=437
	-D MBED_CONF_FAT_CHAN_FF_FS_EXFAT=0
	-D MBED_CONF_FAT_CHAN_FF_FS_HEAPBUF=0
	-D MBED_CONF_FAT_CHAN_FF_FS_LOCK=0
	-D MBED_CONF_FAT_CHAN_FF_FS_MINIMIZE=0
	-D MBED_CONF_FAT_CHAN_FF_FS_NOFSINFO=0
	-D MBED_CONF_FAT_CHAN_FF_FS_NORTC=0
	-D MBED_CONF_FAT_CHAN_FF_FS_READONLY=0
	-D MBED_CONF_FAT_CHAN_FF_FS_REENTRANT=0
	-D MBED_CONF_FAT_CHAN_FF_FS_RPATH=1
	-D MBED_CONF_FAT_CHAN_FF_FS_TIMEOUT=1000
	-D MBED_CONF_FAT_CHAN_FF_FS_TINY=1
	-D MBED_CONF_FAT_CHAN_FF_LFN_BUF=255
	-D MBED_CONF_FAT_CHAN_FF_LFN_UNICODE=0
	-D MBED_CONF_FAT_CHAN_FF_MAX_LFN=255
	-D MBED_CONF_FAT_CHAN_FF_MAX_SS=4096
	-D MBED_CONF_FAT_CHAN_FF_MIN_SS=512
	-D MBED_CONF_FAT_CHAN_FF_MULTI_PARTITION=0
	-D MBED_CONF_FAT_CHAN_FF_NORTC_MDAY=1
	-D MBED_CONF_FAT_CHAN_FF_NORTC_MON=1
	-D MBED_CONF_FAT_CHAN_FF_NORTC_YEAR=2017
	-D MBED_CONF_FAT_CHAN_FF_SFN_BUF=12
	-D MBED_CONF_FAT_CHAN_FF_STRF_ENCODE=3
	-D MBED_CONF_FAT_CHAN_FF_STR_VOLUME_ID=0
	-D MBED_CONF_FAT_CHAN_FF_SYNC_T=HANDLE
	-D MBED_CONF_FAT_CHAN_FF_USE_CHMOD=0
	-D MBED_CONF_FAT_CHAN_FF_USE_EXPAND=0
	-D MBED_CONF_FAT_CHAN_FF_USE_FASTSEEK=0
	-D MBED_CONF_FAT_CHAN_FF_USE_FIND=0
	-D MBED_CONF_FAT_CHAN_FF_USE_FORWARD=0
	-D MBED_CONF_FAT_CHAN_FF_USE_LABEL=0
	-D MBED_CONF_FAT_CHAN_FF_USE_LFN=3
	-D MBED_CONF_FAT_CHAN_FF_USE_MKFS=1
	-D MBED_CONF_FAT_CHAN_FF_USE_STRFUNC=0
	-D MBED_CONF_FAT_CHAN_FF_USE_TRIM=1
	-D MBED_CONF_FAT_CHAN_FF_VOLUMES=4
	-D 'MBED_CONF_FAT_CHAN_FF_VOLUME_STRS="RAM","NAND","CF","SD","SD2","USB","USB2","USB3"'
	-D MBED_CONF_FAT_CHAN_FLUSH_ON_NEW_CLUSTER=0
	-D MBED_CONF_FAT_CHAN_FLUSH_ON_NEW_SECTOR=1

[env:datalogger]
extends = sd_1549
src_filter = +<Datalogger/*>


[env:candapter]
extends = base1549
src_filter = +<Candapter/*>
build_flags = ${base1549.build_flags} -ICandapter/
board_build.ldscript = target/LPC1549_CombinedRam.ld

[env:bletelemetry]
extends = basenrf52
src_filter = +<BleTelemetry/*>
build_flags = -IBleTelemetry/
lib_deps = 
	mbed-falcononishi/MCP2515@0.0.0+sha.b65cb1bbf0ce
